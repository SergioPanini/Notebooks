# HTTP
HTTP - Это текстовый протокол общения, который работает по верх протокола TCP(или TLS если это необходимо).

## Задачи HTTP протокола
- Передача документов
- Передача мета-информации докементов(MIME тип, размер документа, ..)
- Авторизаци.
- Управление сессиями.
- Управление соединением.
- Кэширование документов.

## Структура HTTP запроса/ответа
HTTP сообщение состоит из строки запроса, заголовков и тела. 

### Вид HTTP запроса
Первой строчкой передается HTTP method, в примерах это ``GET``. Затем URL по которому мы обращяемся, здесь он `http://www.google.com/robots.txt` или `/robots.txt`. И в конце идет версия протокола HTTP. Тут мы описали строку запроса.

На последующих строчках передаются заголовки(`Accept`, `User-Agent` ...). Заголовки заканчиваются пустой строкой, это сигнализирует что после пустой строки пойдет тело сообщения.

#### HTTP 1.0
```
GET http://www.google.com/robots.txt HTTP/1.0
Accept: text/html, text/plain
User-Agent: firefox
if-Modefied-Since: Fri, 24 Jul 2015

```

#### HTTP 1.1
```
GET /robots.txt HTTP/1.0
Accept: text/html, text/plain
User-Agent: firefox
Host: www.google.com
Connection: keep-alive
if-Modefied-Since: Fri, 24 Jul 2015

```

### Разница между версиями 1.0 и 1.1
В 1.0 `URL` передается общий, а в 1.1 относительный. 

В 1.1 Хост передается в поле `Host`.

В 1.1 есть заголовок `Connection`, который может сказать закрыть соединение после отправки ответа или оставить.

### Вид HTTP ответа
В первой строчке передается версия HTTP, затем код ответа, в данном случаем это 404, затем передается расщифровка кода(Not Found).
На следующих строчках пишутся заголовки ответа. Заголовки ответа заканчиваются пустой строкой, после нее идет уже тело документа.

Заголовок `Content-Type` это обящательный заголовок, в нем передается MIME тип документа.

Что бы понять когда у нас закончится документ, может быть указан заголовок `Content-Length`, а если его нет, то мы читаем пока соединение не будет закрыто.

#### HTTP 1.1
```
HTTP/1.1 404 Not Found
Server: nginx/1.5.7
Date: Sat, 25 Jul ...
Content-Type: text/html; charset=utf-8
Connection: close

<!Doctype html> .....
```

## HTTP методы
- `GET` - получение документа
- `HEAD` - получение только заголовка
- `POST` - отправка данных на сервер
- `PUT` - отправка документа на вервер
- `DELETE` - удаление докемента на сервере
- Другие

## HTTP коды ответа
### Категории кодов
 - 1xx - Информационные коды
 - 2xx - Успешне отверы 
 - 3xx - Коды перенаправления
 - 4xx - Ошибки на стороне клиента
 - 5xx - Ошибки на стороне сервера

### Базовые коды ответов

#### Коды 2xx
- `200` - OK - Запрос успешно выполнен
- `204` - No Content -Запрос успешно выполнен, но документ пуст

#### Коды 3xx
- `301` - Moved Permanently - Документ сменил URL на всегда. В ответ отправляется новый URL который можно закэшировать на клиенте. Это настраисвается на сервере.
- `302` - Found - Документ сменил URL временно. В ответ так же отправляется новый URL который не должен кэширвоатся на склиенте. Это настраисвается на сервере.
- `304` - Not Modified - Документ не был изменен с последнего обращения клиента. Можно использовать закэшированый докемент.

#### Коды 4xx
- `400` - Bad Request - Неправильный синтаксис запроса(Либо запрос слишком длинный)
- `401` - Unauthorized - Требует авторизации, вернет форму авторизации.
- `403` - Forbidden - Нет доступа к ресурсу.
- `404` - Not Found - Документ по данному URL не найден.

#### Коды 5xx
- `500` - internal Server Error - ошибка сервера, скрипт упал.
- `502` - Bad Gateway - Проксируемый сервер отвечает с ошибкой.
- `504` - Gateway Timeout - Проксируемый сервер превысил время ожидания.

## Заголовки
### Общие заголовки
- `Content-Type` - MIME тип данных + кодировка
- `Content-Length` - Длинна тела-документа
- `Connection` - Управление соединением
- `Content-Encoding` - Кодирование данных, к примеру сжатие gzip 

### Заголовки запроса
- `Authorization` - данные для авторизации
- `Referer` - url предыдущий страницы, с какого URL мы делаем запрос.
- `If-Modefied-Since` - время последней загрузки документа. Нужно это поле для ответа 304.
- `HOST` - хост(опционально для HTTP 1.1 и выше)
-  `User-Agent` - имя клиента
- `Cookie` - куки
- `Accept-*` - множество полей, нужных для соглосования с сервером языка документа, типа документа и других форматов документа.

### Заголовки ответов
- `Date` - время сервера, я синхронизации клиента и сервера.
- `Set-Cookie` - установка куков
- `Server` - имя сервера и его версия
-  `Location` - url для перенаправления
- `Last-Modified` - время последнего изменения документа
